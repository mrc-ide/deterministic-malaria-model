<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model Reference • ICDMM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model Reference">
<meta property="og:description" content="ICDMM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ICDMM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/run_model_example.html">Simplest Model Run</a>
    </li>
    <li>
      <a href="../articles/run_model.html">More Flexible Model Run</a>
    </li>
    <li>
      <a href="../articles/run_model_alternative.html">Alternative Model Runs</a>
    </li>
    <li>
      <a href="../articles/write_own_model.html">Writing Your Own Model</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../CONTRIBUTING.html">Contributing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/deterministic-malaria-model" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="model_reference_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model Reference</h1>
                        <h4 data-toc-skip class="author">Joel Hellewell</h4>
            
            <h4 data-toc-skip class="date">2022-03-31</h4>
      
      
      <div class="hidden name"><code>model_reference.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="human-states">Human states<a class="anchor" aria-label="anchor" href="#human-states"></a>
</h2>
<p>The equations for the human compartments are in section 1.1.1 of <a href="https://doi.org/10.1371/journal.pmed.1000324.s005" class="external-link">Protocol S1</a> of the original Griffin paper.</p>
<p>In the odin model each of the human compartments (S, T, D, A, U, P) have three dimensions: age, biting heterogeneity category, and intervention category. The differential equations for the first age category are slightly different because they need to include people being born into them.</p>
<div class="section level3">
<h3 id="susceptible">Susceptible<a class="anchor" aria-label="anchor" href="#susceptible"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">S</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">S</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">rP</span><span class="op">*</span><span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">rU</span><span class="op">*</span><span class="va">U</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span>
  <span class="va">cov</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">eta</span><span class="op">*</span><span class="va">H</span><span class="op">*</span><span class="va">het_wt</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">S</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">S</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">S</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">rP</span><span class="op">*</span><span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">rU</span><span class="op">*</span><span class="va">U</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span>
  <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">S</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">S</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span></code></pre></div>
<p><span class="math inline">\(\Lambda \mapsto\)</span> <code>FOI</code></p>
<p><span class="math inline">\(r_P \mapsto\)</span> <code>rP</code></p>
<p><span class="math inline">\(r_U \mapsto\)</span> <code>rU</code></p>
<p><span class="math inline">\(\zeta \mapsto\)</span> <code>het_wt</code> are the weights from the biting heterogeneity groups, see Section 1.1.2 of <a href="https://doi.org/10.1371/journal.pmed.1000324.s005" class="external-link">Protocol S1</a>.</p>
<p>The parameter <code>eta</code> (<span class="math inline">\(\eta\)</span>) is the constant background death rate, <code>cov</code> is a vector of the proportion of the population in each intervention category (see interventions section later in this reference), <code>age_rate</code> is equal to the inverse of the size of the age group (see <a href="https://github.com/mrc-ide/dide-deterministic-malaria-model/blob/82069175e66a9ba199aca5fd97172d7b09a4ff1f/R/equilibrium-init-create.R#L61" class="external-link">equilibrium solution</a>), and <code>H</code> is the sum of all human compartments.</p>
</div>
<div class="section level3">
<h3 id="treated">Treated<a class="anchor" aria-label="anchor" href="#treated"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="cn">T</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ft</span><span class="op">*</span><span class="va">clin_inc</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">rT</span><span class="op">*</span><span class="cn">T</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span>
  <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="cn">T</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="cn">T</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ft</span><span class="op">*</span><span class="va">clin_inc</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">rT</span><span class="op">*</span><span class="cn">T</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span>
  <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="cn">T</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="cn">T</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span></code></pre></div>
<p><span class="math inline">\(f_T \mapsto\)</span> <code>ft</code> (proportion of clinical disease that is treated)</p>
<p><span class="math inline">\(r_T \mapsto\)</span> <code>rt</code></p>
<p>For <code>clin_inc</code> see section 1.7 of this guide.</p>
</div>
<div class="section level3">
<h3 id="clinical-disease">(Clinical) Disease<a class="anchor" aria-label="anchor" href="#clinical-disease"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">D</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ft</span><span class="op">)</span><span class="op">*</span><span class="va">clin_inc</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">rD</span><span class="op">*</span><span class="va">D</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span>
  <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">D</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">D</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ft</span><span class="op">)</span><span class="op">*</span><span class="va">clin_inc</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">rD</span><span class="op">*</span><span class="va">D</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span>
  <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">D</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">D</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span></code></pre></div>
<p><span class="math inline">\(r_D \mapsto\)</span> <code>rD</code></p>
</div>
<div class="section level3">
<h3 id="asymptomatic-disease">Asymptomatic Disease<a class="anchor" aria-label="anchor" href="#asymptomatic-disease"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">A</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phi</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">Y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span>
  <span class="va">rD</span><span class="op">*</span><span class="va">D</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">rA</span><span class="op">*</span><span class="va">A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">A</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phi</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">Y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span>
  <span class="va">rD</span><span class="op">*</span><span class="va">D</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">rA</span><span class="op">*</span><span class="va">A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">A</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span></code></pre></div>
<p><span class="math inline">\(r_A \mapsto\)</span> <code>rA</code></p>
<p>The parameter <code>FOI</code> is explained in Section 2.10</p>
</div>
<div class="section level3">
<h3 id="sub-patent-disease">Sub-patent Disease<a class="anchor" aria-label="anchor" href="#sub-patent-disease"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">U</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rA</span><span class="op">*</span><span class="va">A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">U</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">rU</span><span class="op">*</span><span class="va">U</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span>
  <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">U</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">U</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rA</span><span class="op">*</span><span class="va">A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">U</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">rU</span><span class="op">*</span><span class="va">U</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span>
  <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">U</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">U</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span></code></pre></div>
<p><span class="math inline">\(r_U \mapsto\)</span> <code>rU</code></p>
</div>
<div class="section level3">
<h3 id="prophylaxis">Prophylaxis<a class="anchor" aria-label="anchor" href="#prophylaxis"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">P</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rT</span><span class="op">*</span><span class="cn">T</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">rP</span><span class="op">*</span><span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">P</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rT</span><span class="op">*</span><span class="cn">T</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="va">rP</span><span class="op">*</span><span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">eta</span><span class="op">+</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span>
  <span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">P</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clinical-incidence">Clinical Incidence<a class="anchor" aria-label="anchor" href="#clinical-incidence"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The number of individuals able to acquire clinical malaria</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">na</span>,<span class="va">nh</span>,<span class="va">num_int</span><span class="op">)</span>
<span class="va">Y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">S</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">+</span><span class="va">A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">+</span><span class="va">U</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span>

<span class="co"># The number of new cases at this timestep</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">clin_inc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">na</span>,<span class="va">nh</span>,<span class="va">num_int</span><span class="op">)</span>
<span class="va">clin_inc</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phi</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">Y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span></code></pre></div>
<p>An intermediate step used in the differential equations for the T, D, and A compartments. The parameter <code>Y</code> is just a sum of the S, A, and U compartments for each biting and age combination.</p>
<p><span class="math inline">\(\phi \Lambda(S(t) + A(t) + U(t)) \mapsto\)</span> <code>clin_inc</code></p>
<p>The parameter <span class="math inline">\(\phi\)</span> (<code>phi</code>) is the probability of clinical disease upon receiving an infectious bite and is explained in Section 2.5.</p>
</div>
</div>
<div class="section level2">
<h2 id="immunity-states">Immunity states<a class="anchor" aria-label="anchor" href="#immunity-states"></a>
</h2>
<p>The mathematical equations for (most of) the human immunity states are described in section 1.1.3 of <a href="https://doi.org/10.1371/journal.pmed.1000324.s005" class="external-link">Protocol S1</a> of the original Griffin paper.</p>
<p>There are several different types of immunity. In the original Griffin 2010 paper:</p>
<p><span class="math inline">\(I_B \mapsto\)</span> <code>IB</code> (immunity that prevents any infection after bite)</p>
<p><span class="math inline">\(I_C \mapsto\)</span> <code>IC</code> (immunity that reduces chance of clinical disease upon infection)</p>
<p><span class="math inline">\(I_CA \mapsto\)</span> <code>ICA</code> (clinical immunity due to exposure)</p>
<p><span class="math inline">\(I_CM \mapsto\)</span> <code>ICM</code> (clinical immunity due to maternal protection)</p>
<p><span class="math inline">\(I_A\)</span> (immunity that reduces length of patent infection, no longer in model)</p>
<p>In the <a href="https://static-content.springer.com/esm/art%3A10.1038%2Fncomms4136/MediaObjects/41467_2014_BFncomms4136_MOESM428_ESM.pdf" class="external-link">supplementary materials for Griffin Nat Comms 2014</a>, <span class="math inline">\(I_A\)</span> is replaced with “detection immunity”, <span class="math inline">\(I_D\)</span>, that reduces the probability of case detection and reduced infectiousness to mosquitoes (because of reduced parasite density).</p>
<div class="section level3">
<h3 id="x_i">x_I<a class="anchor" aria-label="anchor" href="#x_i"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x_I</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="op">)</span> <span class="co"># intermediate variable for calculating immunity functions</span></code></pre></div>
<p>This is a cryptically named parameter that is a constant defined in the equilibrium solution:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># From https://github.com/mrc-ide/dide-deterministic-malaria-model/blob/82069175e66a9ba199aca5fd97172d7b09a4ff1f/R/equilibrium-init-create.R#L68</span>
 <span class="va">den</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">age_rate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">mpl</span><span class="op">$</span><span class="va">eta</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">na</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="va">den</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">den</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">age_rate</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">mpl</span><span class="op">$</span><span class="va">eta</span><span class="op">)</span>  <span class="co"># proportion in each age_vector group</span>
  <span class="op">}</span>


<span class="co"># From https://github.com/mrc-ide/dide-deterministic-malaria-model/blob/82069175e66a9ba199aca5fd97172d7b09a4ff1f/R/equilibrium-init-create.R#L97</span>
<span class="va">x_I</span> <span class="op">&lt;-</span> <span class="va">den</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">mpl</span><span class="op">$</span><span class="va">eta</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">na</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="va">x_I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">den</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">den</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">age_rate</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>  <span class="co">#temporary variables</span>
  <span class="op">}</span></code></pre></div>
<p>The best way to understand it is as a way of controlling how aging and death change the levels of immunity. If your age groups are thinner (i.e. you have 2-4yo instead of 2-20yo) then immunity will be lost faster if transmission stops because the people with immunity from before transmission stopped will age out of that group faster. There is a different formula with helpful comments in the <code>malariaEquilibrium</code> <a href="https://github.com/mrc-ide/malariaEquilibrium/blob/8b6b45af66f0208ee9bd6f963fcd07a8cddc3493/R/main.R#L63" class="external-link">package</a> developed by Giovanni and Bob.</p>
</div>
<div class="section level3">
<h3 id="maternally-acquired-immunity">Maternally-acquired Immunity<a class="anchor" aria-label="anchor" href="#maternally-acquired-immunity"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">init_ICM_pre</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">nh</span>,<span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">PM</span><span class="op">*</span><span class="op">(</span><span class="va">ICA</span><span class="op">[</span><span class="va">age20l</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">+</span> <span class="va">age_20_factor</span><span class="op">*</span><span class="op">(</span><span class="va">ICA</span><span class="op">[</span><span class="va">age20u</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">-</span><span class="va">ICA</span><span class="op">[</span><span class="va">age20l</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">ICM</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">dCM</span><span class="op">*</span><span class="va">ICM</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">init_ICM_pre</span><span class="op">[</span><span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="va">ICM</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">x_I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">ICM</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">dCM</span><span class="op">*</span><span class="va">ICM</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">ICM</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="va">ICM</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">x_I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></code></pre></div>
<p>The level of maternal immunity is assumed at birth to be a proportion (<span class="math inline">\(P_{CM} \mapsto\)</span> <code>PM</code>) of the clinical immunity of a 20 year old (<span class="math inline">\(I_{C}(20, t) \mapsto\)</span> <code>ICA[age20l, i, j]</code>). Maternal immunity decays at a constant rate (<span class="math inline">\(d_M \mapsto\)</span> <code>dCM</code>)</p>
</div>
<div class="section level3">
<h3 id="exposure-driven-immunity">Exposure-driven Immunity<a class="anchor" aria-label="anchor" href="#exposure-driven-immunity"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">ICA</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="va">uCA</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="va">dCA</span><span class="op">*</span><span class="va">ICA</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span><span class="va">ICA</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="va">x_I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">ICA</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="va">uCA</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="va">dCA</span><span class="op">*</span><span class="va">ICA</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">ICA</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="va">ICA</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">x_I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></code></pre></div>
<p>In the original Griffin paper they consider four different immunity profile functions (<span class="math inline">\(h(X)\)</span>). The odin model uses “Model 3” as described in Section 1.1.3 of <a href="https://doi.org/10.1371/journal.pmed.1000324.s005" class="external-link">Protocol S1</a> for exposure-driven immunity (take note that different immunity profiles are used for other types of immunity in the model!).</p>
<p>Therefore:</p>
<p><span class="math inline">\(h(\Lambda) = \frac{\Lambda}{\gamma\Lambda + 1} \mapsto\)</span> <code>FOI[i,j,k]/(FOI[i,j,k] * uCA + 1)</code></p>
<p>where the value of <span class="math inline">\(\gamma\)</span> is <code>uCA</code> and controls the delay between infection and exposure-driven immunity increasing.</p>
</div>
<div class="section level3">
<h3 id="clinical-immunity">Clinical Immunity<a class="anchor" aria-label="anchor" href="#clinical-immunity"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IC</span><span class="op">[</span>,,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ICM</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">ICA</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span></code></pre></div>
<p>Clinical immunity combines maternal and exposure-driven immunity.</p>
</div>
<div class="section level3">
<h3 id="phi">Phi<a class="anchor" aria-label="anchor" href="#phi"></a>
</h3>
<p>Phi controls the probability of developing clinical disease for a given level of clinical immunity. The latest equation for <span class="math inline">\(\phi\)</span> is equation 7 in the <a href="https://static-content.springer.com/esm/art%3A10.1038%2Fncomms4136/MediaObjects/41467_2014_BFncomms4136_MOESM428_ESM.pdf" class="external-link">supplementary materials for Griffin Nat Comms 2014</a>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phi</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span>,<span class="fl">1</span><span class="op">:</span><span class="va">nh</span>,<span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phi0</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phi1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="op">(</span><span class="va">IC</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="va">IC0</span><span class="op">)</span><span class="op">^</span><span class="va">kC</span><span class="op">)</span> <span class="op">+</span> <span class="va">phi1</span><span class="op">)</span></code></pre></div>
<p><span class="math inline">\(\phi_0 \mapsto\)</span> <code>phi0</code></p>
<p><span class="math inline">\(\phi_1 \mapsto\)</span> <code>phi1</code></p>
<p><span class="math inline">\(I_{C0} \mapsto\)</span> <code>IC0</code></p>
<p><span class="math inline">\(\kappa_C \mapsto\)</span> <code>kC</code></p>
</div>
<div class="section level3">
<h3 id="infection-blocking-immunity">Infection-blocking Immunity<a class="anchor" aria-label="anchor" href="#infection-blocking-immunity"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">IB</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">EIR</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">EIR</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span> <span class="va">uB</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="va">IB</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="va">dB</span> <span class="op">-</span> <span class="va">IB</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="va">x_I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">IB</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">EIR</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">EIR</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span> <span class="va">uB</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="va">IB</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="va">dB</span> <span class="op">-</span> <span class="op">(</span><span class="va">IB</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="va">IB</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">x_I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></code></pre></div>
<p>The <code>EIR</code> at a given time for a given age group (<span class="math inline">\(\epsilon(a, t)\)</span>) is in section 2.11.</p>
<p>Similar to exposure-driven immunity (Section 2.3) the increase in immunity uses a hill function: <span class="math inline">\(h(\epsilon) = \frac{\epsilon}{\gamma\epsilon + 1}\)</span></p>
<p>where here <span class="math inline">\(\gamma\)</span> is <code>uB</code>.</p>
<p><span class="math inline">\(d_B \mapsto\)</span> <code>dB</code></p>
</div>
<div class="section level3">
<h3 id="b">b<a class="anchor" aria-label="anchor" href="#b"></a>
</h3>
<p>b is the probability of any disease from an infectious bite, controlled by infection blocking immunity. It is a function that turns the values in <code>IB</code> into a probability. The latest equation for <code>b</code> is equation 6 in the <a href="https://static-content.springer.com/esm/art%3A10.1038%2Fncomms4136/MediaObjects/41467_2014_BFncomms4136_MOESM428_ESM.pdf" class="external-link">supplementary materials for Griffin Nat Comms 2014</a>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">b0</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">b1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="op">(</span><span class="va">IB</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="va">IB0</span><span class="op">)</span><span class="op">^</span><span class="va">kB</span><span class="op">)</span><span class="op">+</span><span class="va">b1</span><span class="op">)</span></code></pre></div>
<p><span class="math inline">\(b_{0} \mapsto\)</span> <code>b0</code></p>
<p><span class="math inline">\(b_{1} \mapsto\)</span> <code>b1</code></p>
<p><span class="math inline">\(I_{B0} \mapsto\)</span> <code>IB0</code></p>
<p><span class="math inline">\(\kappa_B \mapsto\)</span> <code>kB</code></p>
</div>
<div class="section level3">
<h3 id="detection-immunity">Detection Immunity<a class="anchor" aria-label="anchor" href="#detection-immunity"></a>
</h3>
<p>Detection immunity is introduced in equation 5 in the <a href="https://static-content.springer.com/esm/art%3A10.1038%2Fncomms4136/MediaObjects/41467_2014_BFncomms4136_MOESM428_ESM.pdf" class="external-link">supplementary materials for Griffin Nat Comms 2014</a>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">ID</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">uD</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="va">ID</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="va">dID</span> <span class="op">-</span> <span class="va">ID</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="va">x_I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">ID</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">FOI</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">uD</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="va">ID</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="va">dID</span> <span class="op">-</span> <span class="op">(</span><span class="va">ID</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="va">ID</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">x_I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></code></pre></div>
<p>Again a hill function is used (see Section 2.3) with <span class="math inline">\(\gamma\)</span> as <code>uD</code>.</p>
<p><span class="math inline">\(d_{ID} \mapsto\)</span> <code>dID</code></p>
</div>
<div class="section level3">
<h3 id="probability-of-detection">Probability of Detection<a class="anchor" aria-label="anchor" href="#probability-of-detection"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fd</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fD0</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="op">(</span><span class="va">age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="va">aD</span><span class="op">)</span><span class="op">^</span><span class="va">gammaD</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">p_det</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">na</span>,<span class="va">nh</span>,<span class="va">num_int</span><span class="op">)</span>
<span class="va">p_det</span><span class="op">[</span>,,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">d1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">d1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">fd</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="va">ID</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">/</span><span class="va">ID0</span><span class="op">)</span><span class="op">^</span><span class="va">kD</span><span class="op">)</span></code></pre></div>
<p>The probability that an asymptomatic infection is detected by microscopy is <span class="math inline">\(q \mapsto\)</span> <code>p_det</code> (equation 8 in <a href="https://static-content.springer.com/esm/art%3A10.1038%2Fncomms4136/MediaObjects/41467_2014_BFncomms4136_MOESM428_ESM.pdf" class="external-link">supplementary materials for Griffin Nat Comms 2014</a>).</p>
<p>The function <span class="math inline">\(f_{D} \mapsto\)</span> <code>fD</code> is defined just below it.</p>
<p><span class="math inline">\(f_{D0} \mapsto\)</span> <code>fD0</code></p>
<p><span class="math inline">\(a_D \mapsto\)</span> <code>aD</code></p>
<p><span class="math inline">\(\gamma_D \mapsto\)</span> <code>gammaD</code></p>
<p><span class="math inline">\(d_1 \mapsto\)</span> <code>d1</code></p>
<p><span class="math inline">\(I_{D0} \mapsto\)</span> <code>ID0</code></p>
<p><span class="math inline">\(\kappa_D \mapsto\)</span> <code>kD</code></p>
</div>
<div class="section level3">
<h3 id="force-of-infection">Force of Infection<a class="anchor" aria-label="anchor" href="#force-of-infection"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Force of infection, depends on level of infection blocking immunity</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">FOI_lag</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">na</span>,<span class="va">nh</span>,<span class="va">num_int</span><span class="op">)</span>
<span class="va">FOI_lag</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">EIR</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="kw">if</span><span class="op">(</span><span class="va">IB</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="va">b0</span> <span class="kw">else</span> <span class="va">b</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span>

<span class="co"># Current FOI depends on humans that have been through the latent period</span>
<span class="va">dE</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="op">)</span> <span class="co"># latent period of human infection.</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">FOI</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">na</span>,<span class="va">nh</span>,<span class="va">num_int</span><span class="op">)</span>
<span class="va">FOI</span><span class="op">[</span>,,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/base-defunct.html" class="external-link">delay</a></span><span class="op">(</span><span class="va">FOI_lag</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span>,<span class="va">dE</span><span class="op">)</span></code></pre></div>
<p><code>EIR</code> is defined in Section 2.11</p>
<p><code>EIR * b</code> is the definition for the force of infection (<span class="math inline">\(\Lambda(a, t)\)</span>) given in equation 2 of <a href="https://static-content.springer.com/esm/art%3A10.1038%2Fncomms4136/MediaObjects/41467_2014_BFncomms4136_MOESM428_ESM.pdf" class="external-link">supplementary materials for Griffin Nat Comms 2014</a>. The model lags the value of <code>FOI_lag</code> by the value <code>dE</code> (human latent period) and stores it in <code>FOI</code>.</p>
</div>
<div class="section level3">
<h3 id="eir">EIR<a class="anchor" aria-label="anchor" href="#eir"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EIR</span><span class="op">[</span>,,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">av_human</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="va">rel_foi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="va">foi_age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">Iv</span><span class="op">/</span><span class="va">omega</span></code></pre></div>
<p>Biting and age FOI heterogeneity: (Section 1.1.2 of <a href="https://doi.org/10.1371/journal.pmed.1000324.s005" class="external-link">Protocol S1</a>)</p>
<p><span class="math inline">\(\zeta \mapsto\)</span> <code>rel_foi</code></p>
<p><span class="math inline">\(\psi(a) \mapsto\)</span> <code>foi_age</code></p>
<p>Mosquito model parameters: (Section 1.1.4 of <a href="https://doi.org/10.1371/journal.pmed.1000324.s005" class="external-link">Protocol S1</a>)</p>
<p><span class="math inline">\(I^{v}_{M} \mapsto\)</span> <code>Iv</code> (infectious mosquito population, see Section 4.4)</p>
<p><span class="math inline">\(\alpha^{v} \mapsto\)</span> <code>av_human</code> (see Section 6.3)</p>
<p><span class="math inline">\(\omega \mapsto\)</span> <code>omega</code></p>
<p>where <span class="math inline">\(\omega = \int_{0}^{\infty} \eta(a)\psi(a) da\)</span> is a normalising constant calculated in the <a href="https://github.com/mrc-ide/dide-deterministic-malaria-model/blob/82069175e66a9ba199aca5fd97172d7b09a4ff1f/R/equilibrium-init-create.R#L84" class="external-link">equilibrium solution</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="seasonality-function">Seasonality function<a class="anchor" aria-label="anchor" href="#seasonality-function"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta2</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">ssa0</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">ssa1</span>  <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">ssa2</span>  <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">ssb1</span>  <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">ssb2</span>  <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">ssb3</span>  <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">theta_c</span>  <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>
  <span class="fl">1</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="op">(</span><span class="va">ssa0</span><span class="op">+</span><span class="va">ssa1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">t</span><span class="op">/</span><span class="fl">365</span><span class="op">)</span><span class="op">+</span><span class="va">ssa2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">t</span><span class="op">/</span><span class="fl">365</span><span class="op">)</span><span class="op">+</span><span class="va">ssa3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">t</span><span class="op">/</span><span class="fl">365</span><span class="op">)</span><span class="op">+</span><span class="va">ssb1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">t</span><span class="op">/</span><span class="fl">365</span><span class="op">)</span><span class="op">+</span><span class="va">ssb2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">t</span><span class="op">/</span><span class="fl">365</span><span class="op">)</span><span class="op">+</span> <span class="va">ssb3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">t</span><span class="op">/</span><span class="fl">365</span><span class="op">)</span> <span class="op">)</span> <span class="op">/</span><span class="va">theta_c</span>,<span class="fl">0.001</span><span class="op">)</span></code></pre></div>
<p>The equation for the seasonality fourier function can be found in Section L of <a href="https://doi.org/10.1371/journal.pmed.1002448.s001" class="external-link">Winskill 2017 - S1 Appendix</a>.</p>
<p>This function is a fourier series of the rainfall profile for a given admin 2 region. The seasonality function changes the carrying capacity of the mosquito population over time relative to a baseline carrying capacity (<code>K0</code> - Section 5.2) that is calculated in the equilibrium solution and can be found in <a href="https://github.com/mrc-ide/dide-deterministic-malaria-model/blob/82069175e66a9ba199aca5fd97172d7b09a4ff1f/R/equilibrium-init-create.R#L243" class="external-link">the code</a> and in the <a href="https://static-content.springer.com/esm/art%3A10.1186%2F1756-3305-4-153/MediaObjects/13071_2011_387_MOESM1_ESM.DOC" class="external-link">supplementary material</a> of White 2011 vector model (equation 7).</p>
</div>
<div class="section level2">
<h2 id="mosquito-states">Mosquito States<a class="anchor" aria-label="anchor" href="#mosquito-states"></a>
</h2>
<div class="section level3">
<h3 id="human-infectiousness">Human infectiousness<a class="anchor" aria-label="anchor" href="#human-infectiousness"></a>
</h3>
<p>How infectious humans with asymptomatic infections are to biting mosquitoes (<span class="math inline">\(c_A\)</span>) can vary, whereas the same values for those with clinical (<span class="math inline">\(c_D\)</span>) or sub-patent (<span class="math inline">\(c_U\)</span>) infections are constant. Equations are in the section “Infectiouness to Mosquitoes” <a href="https://static-content.springer.com/esm/art%3A10.1038%2Fncomms4136/MediaObjects/41467_2014_BFncomms4136_MOESM428_ESM.pdf" class="external-link">supplementary materials for Griffin Nat Comms 2014</a>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cA</span><span class="op">[</span>,,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cU</span> <span class="op">+</span> <span class="op">(</span><span class="va">cD</span><span class="op">-</span><span class="va">cU</span><span class="op">)</span><span class="op">*</span><span class="va">p_det</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">^</span><span class="va">gamma1</span></code></pre></div>
<p><span class="math inline">\(c_U \mapsto\)</span> <code>cU</code></p>
<p><span class="math inline">\(c_D \mapsto\)</span> <code>cD</code></p>
<p><span class="math inline">\(q \mapsto\)</span> <code>p_det</code></p>
<p><span class="math inline">\(\gamma_I \mapsto\)</span> <code>gamma1</code></p>
</div>
<div class="section level3">
<h3 id="mosquito-force-of-infection">Mosquito Force of Infection<a class="anchor" aria-label="anchor" href="#mosquito-force-of-infection"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">FOIvijk</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">na</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nh</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">cT</span><span class="op">*</span><span class="cn">T</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">cD</span><span class="op">*</span><span class="va">D</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">cA</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="va">cU</span><span class="op">*</span><span class="va">U</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">rel_foi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="va">av_mosq</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">foi_age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="va">omega</span>
<span class="va">lag_FOIv</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">FOIvijk</span><span class="op">)</span>

<span class="va">FOIv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/base-defunct.html" class="external-link">delay</a></span><span class="op">(</span><span class="va">lag_FOIv</span>, <span class="va">delayGam</span><span class="op">)</span></code></pre></div>
<p><span class="math inline">\(\Lambda^{v}_{M} \mapsto\)</span> <code>FOIvijk</code></p>
<p>An equation for mosqutio FOI is given in Section 1.1.4 of <a href="https://doi.org/10.1371/journal.pmed.1000324.s005" class="external-link">Protocol S1</a>. However, at the end of Section 2.1 in <a href="https://doi.org/10.1371/journal.pmed.1000324.s006" class="external-link">Protocol S2 - Intervention model</a> of the original Griffin 2010 paper there is a discussion about how using IRS changes the probability that a mosquito will bite a human to be different from the probability that a mosquito will bite and survive (since it may now land on a wall and die after feeding). This means that we calculate the human EIR using <span class="math inline">\(\alpha^v \mapsto\)</span> <code>av_human</code> (because all infectious bites on humans are relevant even if the mosquito dies) and the mosquito FOI using <span class="math inline">\(\alpha^v \mapsto\)</span> <code>av_mosq</code> (because we only care about mosquitoes that bite, become infected, and don’t die for FOI from the mosquito perspective).</p>
<p>See Section 6.3 for the code for <code>av_mosq</code> and <code>av_human</code>.</p>
<p>The FOI is lagged to account for the extrinsic incubation period of the parasite in the mosquito. tel ## Mosquito incidence</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">mu</span><span class="op">*</span><span class="va">delayMos</span><span class="op">)</span>
<span class="va">ince</span> <span class="op">&lt;-</span> <span class="va">FOIv</span> <span class="op">*</span> <span class="va">Sv</span>
<span class="va">lag_incv</span> <span class="op">&lt;-</span> <span class="va">ince</span> <span class="op">*</span> <span class="va">surv</span>
<span class="va">incv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/base-defunct.html" class="external-link">delay</a></span><span class="op">(</span><span class="va">lag_incv</span>, <span class="va">delayMos</span><span class="op">)</span></code></pre></div>
<p>The probability that a mosquito survives from acquiring infection until sporozoite emergence is given in Section 1.1.4 of <a href="https://doi.org/10.1371/journal.pmed.1000324.s005" class="external-link">Protocol S1</a> as <span class="math inline">\(P^{v}_{M} = exp(-\mu\tau_M)\)</span> where:</p>
<p><span class="math inline">\(P^{v}_{M} \mapsto\)</span> <code>surv</code></p>
<p><span class="math inline">\(\mu \mapsto\)</span> <code>mu</code></p>
<p><span class="math inline">\(\tau_M \mapsto\)</span> <code>delayMos</code></p>
<p>In the odin model the parameter <code>incv</code> calculates the incidence of infection in susceptible mosquitoes after accounting for the latent period and mosquito mortality during this time.</p>
</div>
<div class="section level3">
<h3 id="mosquito-compartments">Mosquito compartments<a class="anchor" aria-label="anchor" href="#mosquito-compartments"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Number of mosquitoes born (depends on PL, number of larvae), or is constant outside of seasonality</span>
<span class="va">betaa</span> <span class="op">&lt;-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">PL</span><span class="op">/</span><span class="va">dPL</span>
<span class="co">#betaa &lt;- mv0 * mu0 * theta2</span>

<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">Sv</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">ince</span> <span class="op">-</span> <span class="va">mu</span><span class="op">*</span><span class="va">Sv</span> <span class="op">+</span> <span class="va">betaa</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">Ev</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ince</span> <span class="op">-</span> <span class="va">incv</span> <span class="op">-</span> <span class="va">mu</span><span class="op">*</span><span class="va">Ev</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">Iv</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">incv</span> <span class="op">-</span> <span class="va">mu</span><span class="op">*</span><span class="va">Iv</span>

<span class="co"># Total mosquito population</span>
<span class="va">mv</span> <span class="op">=</span> <span class="va">Sv</span><span class="op">+</span><span class="va">Ev</span><span class="op">+</span><span class="va">Iv</span></code></pre></div>
<p>Mosquito equations are detailed in Section 1.1.4 of <a href="https://doi.org/10.1371/journal.pmed.1000324.s005" class="external-link">Protocol S1</a></p>
</div>
</div>
<div class="section level2">
<h2 id="larval-states">Larval states<a class="anchor" aria-label="anchor" href="#larval-states"></a>
</h2>
<p>The Larval model was introduced in <a href="https://parasitesandvectors.biomedcentral.com/articles/10.1186/1756-3305-4-153" class="external-link">White P&amp;V 2011</a>.</p>
<p>Some of the notation in the larval model overlaps with the rest of the transmission model so the names are different in the odin code.</p>
<div class="section level3">
<h3 id="egg-oviposition-rate">Egg oviposition rate<a class="anchor" aria-label="anchor" href="#egg-oviposition-rate"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eov</span> <span class="op">&lt;-</span> <span class="va">betaL</span> <span class="op">/</span> <span class="va">mu</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">mu</span><span class="op">/</span><span class="va">fv</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="va">beta_larval</span> <span class="op">&lt;-</span> <span class="va">eov</span><span class="op">*</span><span class="va">mu</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">mu</span><span class="op">/</span><span class="va">fv</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">mu</span><span class="op">/</span><span class="va">fv</span><span class="op">)</span><span class="op">)</span> <span class="co"># Number of eggs laid per day</span>
<span class="va">b_lambda</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">gammaL</span><span class="op">*</span><span class="va">muLL</span><span class="op">/</span><span class="va">muEL</span><span class="op">-</span><span class="va">dEL</span><span class="op">/</span><span class="va">dLL</span><span class="op">+</span><span class="op">(</span><span class="va">gammaL</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">muLL</span><span class="op">*</span><span class="va">dEL</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">b_lambda</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">*</span><span class="va">b_lambda</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">gammaL</span><span class="op">*</span><span class="va">beta_larval</span><span class="op">*</span><span class="va">muLL</span><span class="op">*</span><span class="va">dEL</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">muEL</span><span class="op">*</span><span class="va">mu0</span><span class="op">*</span><span class="va">dLL</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">dPL</span><span class="op">*</span><span class="va">muPL</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><span class="math inline">\(\omega \mapsto\)</span> <code>lambda</code></p>
<p>(<span class="math inline">\(\omega\)</span> is in equation 6 of section 3 of the <a href="https://static-content.springer.com/esm/art%3A10.1186%2F1756-3305-4-153/MediaObjects/13071_2011_387_MOESM1_ESM.DOC" class="external-link">supplementary material for White P&amp;V 2011</a>)</p>
<p><code>b_lambda</code> is a smaller section of equation 6 for <span class="math inline">\(\omega\)</span> equal to</p>
<p><span class="math inline">\(-\frac{1}{2}(\gamma\frac{\mu^{0}_L}{\mu^{0}_E} - \frac{d_E}{d_L} + (\gamma - 1)\mu^{0}_L d_E)\)</span></p>
<p><span class="math inline">\(\gamma \mapsto\)</span> <code>gammaL</code></p>
<p><span class="math inline">\(\mu^{0}_L \mapsto\)</span> <code>muLL</code></p>
<p><span class="math inline">\(d_L \mapsto\)</span> <code>dLL</code></p>
<p><span class="math inline">\(d_E \mapsto\)</span> <code>dEL</code></p>
<p><span class="math inline">\(\mu^{0}_E \mapsto\)</span> <code>muEL</code></p>
<p><span class="math inline">\(\beta \mapsto\)</span> <code>beta_larval</code> (average eggs laid per day, determines new larvae production)</p>
<p>The parameter called <code>eov</code> requires some reverse engineering:</p>
<p><span class="math inline">\(eov = \frac{\beta_{L}(exp(\delta\mu_{M}) - 1)}{\mu_{M}}\)</span></p>
<p>where <span class="math inline">\(\mu_M\)</span> is the mosquito mortality rate (<code>mu</code>) and <span class="math inline">\(\delta = \frac{1}{f_v}\)</span> is the days between oviposition (<code>fv</code> is the feeding rate in the model so <code>1/fv</code> gives time between feeds and therefore oviposition after feeding).</p>
<p>From equation 3 in the methods section of <a href="https://parasitesandvectors.biomedcentral.com/articles/10.1186/1756-3305-4-153" class="external-link">White P&amp;V 2011</a> we know that:</p>
<p><span class="math inline">\(\beta_{max} = \frac{\epsilon_{max}\mu_M}{exp(\delta\mu_M - 1)}\)</span></p>
<p>which can be re-arranged to give</p>
<p><span class="math inline">\(\epsilon_{max} = \frac{\beta_{max} exp(\delta\mu_M - 1)}{\mu_M}\)</span></p>
<p>Therefore we can work out that <span class="math inline">\(\epsilon_{max} \mapsto\)</span> <code>eov</code> and <span class="math inline">\(\beta_{max} \mapsto\)</span> <code>betaL</code>.</p>
</div>
<div class="section level3">
<h3 id="carrying-capacity">Carrying capacity<a class="anchor" aria-label="anchor" href="#carrying-capacity"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">K0</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">mv0</span><span class="op">*</span><span class="va">dLL</span><span class="op">*</span><span class="va">mu0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">dPL</span><span class="op">*</span><span class="va">muPL</span><span class="op">)</span><span class="op">*</span><span class="va">gammaL</span><span class="op">*</span><span class="op">(</span><span class="va">lambda</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">lambda</span><span class="op">/</span><span class="op">(</span><span class="va">muLL</span><span class="op">*</span><span class="va">dEL</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">muLL</span><span class="op">*</span><span class="va">dLL</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>

<span class="co"># Seasonal carrying capacity KL = base carrying capacity K0 * effect for time of year theta:</span>
<span class="va">KL</span> <span class="op">&lt;-</span> <span class="va">K0</span><span class="op">*</span><span class="va">theta2</span></code></pre></div>
<p>The equation <span class="math inline">\(K \mapsto\)</span> <code>K0</code> is equation 7 in section 3 of the <a href="https://static-content.springer.com/esm/art%3A10.1186%2F1756-3305-4-153/MediaObjects/13071_2011_387_MOESM1_ESM.DOC" class="external-link">supplementary material for White P&amp;V 2011</a>.</p>
<p><code>KL</code> is the larval carrying capacity which is scaled up according to seasonality by <code>theta2</code> (see Section 3 above)</p>
</div>
<div class="section level3">
<h3 id="birth-and-death-rate">Birth and death rate<a class="anchor" aria-label="anchor" href="#birth-and-death-rate"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fv</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span> <span class="va">tau1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">zbar</span><span class="op">)</span> <span class="op">+</span> <span class="va">tau2</span> <span class="op">)</span> <span class="co"># mosquito feeding rate (zbar from intervention param.)</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">fv</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">p1</span><span class="op">*</span><span class="va">p2</span><span class="op">)</span> <span class="co"># mosquito death rate</span></code></pre></div>
<p>See Section 4 of the <a href="https://static-content.springer.com/esm/art%3A10.1186%2F1756-3305-4-153/MediaObjects/13071_2011_387_MOESM1_ESM.DOC" class="external-link">supplementary material for White P&amp;V 2011</a>.</p>
<p><span class="math inline">\(f \mapsto\)</span> <code>fv</code></p>
<p><span class="math inline">\(\mu_{M} \mapsto\)</span> <code>mu</code></p>
<p><span class="math inline">\(\tau_1 \mapsto\)</span> <code>tau1</code> (Time spent seeking blood meal during gonotrophic cycle)</p>
<p><span class="math inline">\(\tau_2 \mapsto\)</span> <code>tau2</code> (Time spent resting during gonotrophic cycle)</p>
<p><span class="math inline">\(p_1 \mapsto\)</span> <code>p10</code> Probability of surviving blood meal with no net coverage (the parameter <code>p1</code> in the model is the probability of surviving a blood meal for a given intervention coverage - see Section 6.3)</p>
<p><span class="math inline">\(p_2 \mapsto\)</span> <code>p2</code> Probability of surviving one resting cycle (does not change with intervention coverage)</p>
<p><span class="math inline">\(z \mapsto\)</span> <code>zbar</code> average probability of trying again after unsuccessful feeding attempt (see equation 11 in section 4 of the <a href="https://static-content.springer.com/esm/art%3A10.1186%2F1756-3305-4-153/MediaObjects/13071_2011_387_MOESM1_ESM.DOC" class="external-link">supplementary material for White P&amp;V 2011</a>).</p>
</div>
<div class="section level3">
<h3 id="larval-compartments">Larval compartments<a class="anchor" aria-label="anchor" href="#larval-compartments"></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># (beta_larval (egg rate) * total mosquito) - den. dep. egg mortality - egg hatching</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">EL</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">beta_larval</span><span class="op">*</span><span class="va">mv</span><span class="op">-</span><span class="va">muEL</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="op">(</span><span class="va">EL</span><span class="op">+</span><span class="va">LL</span><span class="op">)</span><span class="op">/</span><span class="va">KL</span><span class="op">)</span><span class="op">*</span><span class="va">EL</span> <span class="op">-</span> <span class="va">EL</span><span class="op">/</span><span class="va">dEL</span>
<span class="co"># egg hatching - den. dep. mortality - maturing larvae</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">LL</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">EL</span><span class="op">/</span><span class="va">dEL</span> <span class="op">-</span> <span class="va">muLL</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">gammaL</span><span class="op">*</span><span class="op">(</span><span class="va">EL</span> <span class="op">+</span> <span class="va">LL</span><span class="op">)</span><span class="op">/</span><span class="va">KL</span><span class="op">)</span><span class="op">*</span><span class="va">LL</span> <span class="op">-</span> <span class="va">LL</span><span class="op">/</span><span class="va">dLL</span>
<span class="co"># pupae - mortality - fully developed pupae</span>
<span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">PL</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">LL</span><span class="op">/</span><span class="va">dLL</span> <span class="op">-</span> <span class="va">muPL</span><span class="op">*</span><span class="va">PL</span> <span class="op">-</span> <span class="va">PL</span><span class="op">/</span><span class="va">dPL</span></code></pre></div>
<p>Larval compartments are described in <a href="https://parasitesandvectors.biomedcentral.com/articles/10.1186/1756-3305-4-153" class="external-link">White P&amp;V 2011</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="interventions">Interventions<a class="anchor" aria-label="anchor" href="#interventions"></a>
</h2>
<p>The intervention model details are described in <a href="https://doi.org/10.1371/journal.pmed.1000324.s006" class="external-link">Protocol S2</a> of the original Griffin 2010 paper.</p>
<div class="section level3">
<h3 id="mortality-and-repellency">Mortality and repellency<a class="anchor" aria-label="anchor" href="#mortality-and-repellency"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculates decay for ITN/IRS</span>
<span class="va">ITN_decay</span> <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">ITN_IRS_on</span><span class="op">)</span> <span class="fl">0</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="va">ITN_IRS_on</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="va">ITN_interval</span><span class="op">)</span> <span class="op">*</span> <span class="va">itn_loss</span><span class="op">)</span>
<span class="va">IRS_decay</span> <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">ITN_IRS_on</span><span class="op">)</span> <span class="fl">0</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="va">ITN_IRS_on</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="va">IRS_interval</span><span class="op">)</span> <span class="op">*</span> <span class="va">irs_loss</span><span class="op">)</span>

<span class="co"># The r,d and s values turn on after ITN_IRS_on and decay accordingly</span>
<span class="va">d_ITN</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">ITN_IRS_on</span><span class="op">)</span> <span class="fl">0</span> <span class="kw">else</span> <span class="va">d_ITN0</span><span class="op">*</span><span class="va">ITN_decay</span>
<span class="va">r_ITN</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">ITN_IRS_on</span><span class="op">)</span> <span class="fl">0</span> <span class="kw">else</span> <span class="va">r_ITN1</span> <span class="op">+</span> <span class="op">(</span><span class="va">r_ITN0</span> <span class="op">-</span> <span class="va">r_ITN1</span><span class="op">)</span><span class="op">*</span><span class="va">ITN_decay</span>
<span class="va">s_ITN</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">ITN_IRS_on</span><span class="op">)</span> <span class="fl">1</span> <span class="kw">else</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">d_ITN</span> <span class="op">-</span> <span class="va">r_ITN</span>

<span class="va">r_IRS</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">ITN_IRS_on</span><span class="op">)</span> <span class="fl">0</span> <span class="kw">else</span> <span class="va">r_IRS0</span><span class="op">*</span><span class="va">IRS_decay</span>
<span class="va">d_IRS</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">ITN_IRS_on</span><span class="op">)</span> <span class="fl">0</span> <span class="kw">else</span> <span class="va">chi</span><span class="op">*</span><span class="va">d_IRS0</span><span class="op">*</span><span class="va">IRS_decay</span>
<span class="va">s_IRS</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">ITN_IRS_on</span><span class="op">)</span> <span class="fl">1</span> <span class="kw">else</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">d_IRS</span></code></pre></div>
<p><code>ITN_decay</code> and <code>IRS_decay</code> control the decay in the effectiveness of ITNs and IRS in terms of mortality and repelling ability.</p>
<p>See Section 2.1.1.1 (pgs 8 &amp; 9) in <a href="https://doi.org/10.1371/journal.pmed.1000324.s006" class="external-link">Protocol S2</a> for the equations for the parameters below:</p>
<p><span class="math inline">\(\gamma_N \mapsto\)</span> <code>itn_loss</code></p>
<p><span class="math inline">\(r_{N0} \mapsto\)</span> <code>r_ITN0</code></p>
<p><span class="math inline">\(r_{NM} \mapsto\)</span> <code>r_ITN1</code></p>
<p><span class="math inline">\(r_N \mapsto\)</span> <code>r_ITN</code></p>
<p><span class="math inline">\(d_{N0} \mapsto\)</span> <code>d_ITN0</code></p>
<p><span class="math inline">\(d_N \mapsto\)</span> <code>d_ITN</code></p>
<p><span class="math inline">\(s_N \mapsto\)</span> <code>s_ITN</code></p>
<p><span class="math inline">\(r_{S0} \mapsto\)</span> <code>r_IRS0</code></p>
<p><span class="math inline">\(\gamma_S \mapsto\)</span> <code>irs_loss</code></p>
<p><span class="math inline">\(r_S \mapsto\)</span> <code>r_IRS</code></p>
<p><span class="math inline">\(\chi \mapsto\)</span> <code>chi</code></p>
<p><span class="math inline">\(d_{S0} \mapsto\)</span> <code>d_IRS0</code></p>
<p><span class="math inline">\(d_S \mapsto\)</span> <code>d_IRS</code></p>
<p><span class="math inline">\(s_S \mapsto\)</span> <code>s_IRS</code></p>
</div>
<div class="section level3">
<h3 id="probabilities-of-biting-and-survival">Probabilities of biting and survival<a class="anchor" aria-label="anchor" href="#probabilities-of-biting-and-survival"></a>
</h3>
<p>See Table S2.2 in <a href="https://doi.org/10.1371/journal.pmed.1000324.s006" class="external-link">Protocol S2</a> of the original Griffin 2010 paper.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># probability that mosquito bites and survives for each intervention category</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">w_</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="va">w_</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">w_</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">bites_Bed</span> <span class="op">+</span> <span class="va">bites_Bed</span><span class="op">*</span><span class="va">s_ITN</span>
<span class="va">w_</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">bites_Indoors</span> <span class="op">+</span> <span class="va">bites_Indoors</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">r_IRS</span><span class="op">)</span><span class="op">*</span><span class="va">s_IRS</span>
<span class="va">w_</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">bites_Indoors</span> <span class="op">+</span> <span class="va">bites_Bed</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">r_IRS</span><span class="op">)</span><span class="op">*</span><span class="va">s_ITN</span><span class="op">*</span><span class="va">s_IRS</span> <span class="op">+</span> <span class="op">(</span><span class="va">bites_Indoors</span> <span class="op">-</span> <span class="va">bites_Bed</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">r_IRS</span><span class="op">)</span><span class="op">*</span><span class="va">s_IRS</span>
<span class="va">w</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">w_</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">num_int</span>

<span class="co"># probability that mosq feeds during a single attempt for each int. cat.</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">yy_</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="va">yy_</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">yy_</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">w_</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="va">yy_</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">bites_Indoors</span> <span class="op">+</span> <span class="va">bites_Indoors</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">r_IRS</span><span class="op">)</span>
<span class="va">yy_</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">bites_Indoors</span> <span class="op">+</span> <span class="va">bites_Bed</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">r_IRS</span><span class="op">)</span><span class="op">*</span><span class="va">s_ITN</span> <span class="op">+</span> <span class="op">(</span><span class="va">bites_Indoors</span> <span class="op">-</span> <span class="va">bites_Bed</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">r_IRS</span><span class="op">)</span>
<span class="va">yy</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">yy_</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">yy</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">num_int</span>

<span class="co"># probability that mosquito is repelled during a single attempt for each int. cat.</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">z_</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="va">z_</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">z_</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">bites_Bed</span><span class="op">*</span><span class="va">r_ITN</span>
<span class="va">z_</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">bites_Indoors</span><span class="op">*</span><span class="va">r_IRS</span>
<span class="va">z_</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">bites_Bed</span><span class="op">*</span><span class="op">(</span><span class="va">r_IRS</span><span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">r_IRS</span><span class="op">)</span><span class="op">*</span><span class="va">r_ITN</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">bites_Indoors</span> <span class="op">-</span> <span class="va">bites_Bed</span><span class="op">)</span><span class="op">*</span><span class="va">r_IRS</span>
<span class="va">z</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z_</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">num_int</span></code></pre></div>
<p><span class="math inline">\(\Phi_I \mapsto\)</span> <code>bites_Indoors</code></p>
<p><span class="math inline">\(\Phi_B \mapsto\)</span> <code>bites_Bed</code></p>
</div>
<div class="section level3">
<h3 id="average-biting-rates">Average biting rates<a class="anchor" aria-label="anchor" href="#average-biting-rates"></a>
</h3>
<p>See pages 5-6 in <a href="https://doi.org/10.1371/journal.pmed.1000324.s006" class="external-link">Protocol S2</a> of the original Griffin 2010 paper.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculating Z (zbar) and W (wbar) - see Supplementary materials 2 for details</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">zhi</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">num_int</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">whi</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">num_int</span>
<span class="va">zhi</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cov</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="va">whi</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cov</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="va">w</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="va">zh</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">ITN_IRS_on</span><span class="op">)</span> <span class="fl">0</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">zhi</span><span class="op">)</span>
<span class="va">wh</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">ITN_IRS_on</span><span class="op">)</span> <span class="fl">1</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">whi</span><span class="op">)</span>
<span class="co"># Z (zbar) - average probability of mosquito trying again during single feeding attempt</span>
<span class="va">zbar</span> <span class="op">&lt;-</span> <span class="va">Q0</span><span class="op">*</span><span class="va">zh</span>
<span class="co"># W (wbar) - average probability of mosquito successfully feeding during single attempt</span>
<span class="va">wbar</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">Q0</span> <span class="op">+</span> <span class="va">Q0</span><span class="op">*</span><span class="va">wh</span>

<span class="co"># p1 is the updated p10 given that interventions are now in place:</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">wbar</span><span class="op">*</span><span class="va">p10</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">zbar</span><span class="op">*</span><span class="va">p10</span><span class="op">)</span>
<span class="va">Q</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">Q0</span><span class="op">)</span><span class="op">/</span><span class="va">wbar</span> <span class="co"># updated anthropophagy given interventions</span>
<span class="va">av</span> <span class="op">&lt;-</span> <span class="va">fv</span><span class="op">*</span><span class="va">Q</span> <span class="co"># biting rate on humans</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">av_mosq</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">num_int</span>
<span class="va">av_mosq</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">av</span><span class="op">*</span><span class="va">w</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="va">wh</span> <span class="co"># rate at which mosquitoes bite each int. cat.</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">av_human</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">num_int</span>
<span class="va">av_human</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">num_int</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">av</span><span class="op">*</span><span class="va">yy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="va">wh</span> <span class="co"># biting rate on humans in each int. cat.</span></code></pre></div>
<p><span class="math inline">\(Z \mapsto\)</span> <code>zbar</code></p>
<p><span class="math inline">\(W \mapsto\)</span> <code>wbar</code></p>
<p><span class="math inline">\(Q^v \mapsto\)</span> <code>Q</code></p>
<p><span class="math inline">\(p_1 \mapsto\)</span> <code>p1</code></p>
<p>The average biting rate (<span class="math inline">\(\alpha_v \mapsto\)</span> <code>av_mosq</code> or <code>av_human</code>) is calculated using <code>w</code> or <code>yy</code> depending on whether it matters that the mosquito may die after feeding. For the FOI on mosquitoes, we only want to count infections in mosquitoes that don’t then die due to IRS. For the EIR for humans, infectious bites count even if mosquitoes die due to IRS afterwards.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Joel Hellewell, Hannah Slater, Juliette Unwin, OJ Watson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
