<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>More Flexible Model Run â€¢ ICDMM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="More Flexible Model Run">
<meta property="og:description" content="ICDMM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ICDMM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/run_model_example.html">Simplest Model Run</a>
    </li>
    <li>
      <a href="../articles/run_model.html">More Flexible Model Run</a>
    </li>
    <li>
      <a href="../articles/run_model_alternative.html">Alternative Model Runs</a>
    </li>
    <li>
      <a href="../articles/write_own_model.html">Writing Your Own Model</a>
    </li>
    <li>
      <a href="../articles/model_reference.html">Model Reference</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../CONTRIBUTING.html">Contributing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/deterministic-malaria-model" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="run_model_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>More Flexible Model Run</h1>
                        <h4 data-toc-skip class="author">H. Juliette T. Unwin &amp; Joel Hellewell</h4>
            
            <h4 data-toc-skip class="date">2023-01-24</h4>
      
      
      <div class="hidden name"><code>run_model.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>If you are able to the run the <code>run_model_example</code> function (see this <a href="https://mrc-ide.github.io/deterministic-malaria-model/articles/run_model_example.html">vignette</a>), then you can move on to running the base malaria model more flexibly or run alternative models with different intervention methods.</p>
</div>
<div class="section level2">
<h2 id="default-use-of-function">Default use of function<a class="anchor" aria-label="anchor" href="#default-use-of-function"></a>
</h2>
<p>The <code>run_model</code> function has the following default arguments:</p>
<ol style="list-style-type: decimal">
<li>model - The name of the malaria model to run (default = base model)</li>
<li>The number of heterogeneity brackets - <code>het_brackets = 5</code>
</li>
<li>The vector of age compartments - <code>age = c(0,0.25,0.5,0.75,1,1.25,1.5,1.75,2,3.5,5,7.5,10,15,20,30,40,50,60,70,80)</code>
</li>
<li>The initial EIR - <code>init_EIR = 10</code>
</li>
<li>The percentage of the population that gets treated - <code>init_ft = 0.4</code>
</li>
<li>The country - <code>country = NULL</code>
</li>
<li>The admin 2 unit - <code>admin2 = NULL</code>
</li>
</ol>
<p>By default the <code>run_model</code> function runs the model for 100 days in a country with no seasonality (achieved by setting <code>admin2</code> and <code>country</code> equal to <code>NULL</code>) and no interventions. We can run the model and plot the prevalence as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ICDMM</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">t</span>,<span class="va">out</span><span class="op">$</span><span class="va">prev</span>, main<span class="op">=</span> <span class="st">"Prevalance"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, type<span class="op">=</span><span class="st">'l'</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="providing-alternative-arguments">Providing alternative arguments<a class="anchor" aria-label="anchor" href="#providing-alternative-arguments"></a>
</h2>
<p>You can provide new parameter values for parameters in the model (model parameters are listed here) by including them as arguments in the <code>run_model</code> function:</p>
<p>It is possible to change the default arguments for the <code>create_r_model</code> function as shown below by setting the initial EIR (the average number of infectious bites per person each year) to 50 instead of the default value of 10:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span>init_EIR <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">t</span>,<span class="va">out</span><span class="op">$</span><span class="va">prev</span>, main<span class="op">=</span> <span class="st">"Prevalance"</span>, type<span class="op">=</span><span class="st">'l'</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>We can also change the length of time that the model is run for by setting <code>time = 1000</code> (days) and introduce an intervention by giving 75% of the population an insecticidal bed net (<code>itn_cov = 0.75</code>) after 365 days (<code>ITN_IRS_on = 365</code>). We also need to specify the number of intervention categories (<code>num_int</code>), if we introduce nets we need 2 categories for people with and without nets. If we introduce ITNs and IRS, we need 4 categories for no intervention, nets only, IRS only, and both nets and IRS. Here we compare introducing 75% ITN coverage after 365 days to 75% ITN coverage + 40% IRS coverage:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># ITN only</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span>init_EIR <span class="op">=</span> <span class="fl">50</span>, </span>
<span>                 time <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                 ITN_IRS_on <span class="op">=</span> <span class="fl">365</span>,</span>
<span>                 itn_cov <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>                 num_int <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ITN + IRS</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span>init_EIR <span class="op">=</span> <span class="fl">50</span>, </span>
<span>                 time <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                 ITN_IRS_on <span class="op">=</span> <span class="fl">365</span>,</span>
<span>                 itn_cov <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>                 irs_cov <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>                 num_int <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">t</span>,<span class="va">out</span><span class="op">$</span><span class="va">prev</span>, main<span class="op">=</span> <span class="st">"Prevalance"</span>, type<span class="op">=</span><span class="st">'l'</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">out2</span><span class="op">$</span><span class="va">t</span>, <span class="va">out2</span><span class="op">$</span><span class="va">prev</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">365</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="changing-seasonality-parameters">Changing seasonality parameters<a class="anchor" aria-label="anchor" href="#changing-seasonality-parameters"></a>
</h2>
<p>It is possible to change the seasonality parameters by specifying a named admin unit or both an admin unit and country to the <code>run_model</code> function. The latter is better when the admin name is common. Fuzzy matching is used to match the provided arguments with the data set provided in the package. The data set can be loaded into your workspace as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seasonality_data</span> <span class="op">&lt;-</span> <span class="fu">ICDMM</span><span class="fu">::</span><span class="fu"><a href="../reference/load_file.html">load_file</a></span><span class="op">(</span><span class="st">"admin_units_seasonal.rds"</span><span class="op">)</span></span></code></pre></div>
<p>You can then specify the location that you would like to load the seasonality profile for by specifying <code>country</code> and <code>admin2</code> using character strings when calling the <code>run_model</code> function (An example is shown in the previous <a href="https://mrc-ide.github.io/deterministic-malaria-model/articles/run_model_example.html">vignette</a>.</p>
</div>
<div class="section level2">
<h2 id="using-alternative-models">Using alternative models<a class="anchor" aria-label="anchor" href="#using-alternative-models"></a>
</h2>
<p>It is also possible to change the odin model by editing the <code>model</code> argument. By default the <code>run_model</code> function uses the basic malaria model (called <code>odin_model</code>). You can see the four different models currently included in the package in the <code>inst/odin</code> directory. To run a different model just specify its name, however you may encounter errors unless you specify parameter values for extra parameters in the alternative models that may not have a default value.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Running this will give an error because we have not specified the value of the parameter hrp2_prop</span></span>
<span><span class="co">#run_model(model = "odin_model_hrp2")</span></span>
<span><span class="co">## We can specify the new parameter value in the function call</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"odin_model_hrp2"</span>, hrp2_prop <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">t</span>,<span class="va">out</span><span class="op">$</span><span class="va">prev</span>, main<span class="op">=</span> <span class="st">"Prevalance"</span>, type<span class="op">=</span><span class="st">'l'</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Joel Hellewell, Hannah Slater, Juliette Unwin, OJ Watson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
